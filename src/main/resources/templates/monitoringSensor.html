<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title th:text="'Sensor Monitoring - ' + ${sensor.idSensor}">Sensor Monitoring</title>
    <link rel="stylesheet" href="/css/styles.css"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}"/>
    <link rel="stylesheet" href="/css/monitoringGateway.css"/>
    <style>
        .info-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:14px; }
        .card { background:#fff; border-radius:12px; padding:14px; box-shadow:0 1px 3px rgba(0,0,0,.08); }
        .badge { padding:4px 8px; border-radius:8px; background:#ddd; display:inline-block; }
        .badge--ok { background:#1f9d55; color:white; }
        .badge--off { background:#9ca3af; color:white; }
        .section-title { margin-top:22px; margin-bottom:8px; font-weight:600; color:#374151; }
    </style>

    <!-- Variables servies côté serveur pour le JS (data-* sur <html>) -->
    <script th:inline="javascript">
        document.documentElement.dataset.deviceId  = /*[[${sensor.idSensor}]]*/ '';
        document.documentElement.dataset.gatewayId = /*[[${sensor.idGateway}]]*/ '';
        document.documentElement.dataset.devType   = /*[[${sensor.deviceType}]]*/ '';
        document.documentElement.dataset.sseToken  = /*[[${sseToken}]]*/ '';
    </script>

    <!-- JS séparé -->
    <script src="/javascript/monitoringSensor.js" defer></script>
</head>

<body data-page="monitoringSensor">
<div th:replace="fragments/header :: appHeader(pageTitle='My profile', homeUrl=@{/})"></div>

<header th:text="${sensor.deviceType} ?: ${sensor.idSensor}">Sensor</header>

<main>

    <!-- Infos statiques -->
    <section class="info-grid">
        <div class="card">
            <h4>Status</h4>
            <p>
        <span class="badge" th:classappend="${sensor.status} ? ' badge--ok' : ' badge--off'">
          <img th:src="${sensor.status} ? '/image/toggle_on.svg' : '/image/toggle_off.svg'" alt="Status"/>
          <span th:text="${sensor.status} ? 'Active' : 'Inactive'">--</span>
        </span>
            </p>
        </div>

        <div class="card"><h4>Sensor ID</h4>
            <p th:text="${sensor.idSensor}">--</p></div>

        <div class="card"><h4>Device Type</h4>
            <p th:text="${sensor.deviceType}">--</p></div>

        <div class="card"><h4>Commissioning Date</h4>
            <p th:text="${sensor.commissioningDate} ?: '--'">--</p></div>

        <div class="card">
            <h4>Gateway</h4>
            <p th:with="gid=${sensor.idGateway}, ip=${gatewayIp} ?: ''">
                <a class="link"
                   th:href="@{|/manage-gateways/monitoring/${gid}/view?ip=${ip}|}"
                   th:text="${gatewayName} ?: ${gid}">--</a>
            </p>
        </div>

        <div class="card"><h4>Building</h4>
            <p th:text="${sensor.buildingName} ?: '--'">--</p></div>

        <div class="card"><h4>Floor</h4>
            <p th:text="${sensor.floor} ?: '--'">--</p></div>

        <div class="card"><h4>Location</h4>
            <p th:text="${sensor.location} ?: '--'">--</p></div>

        <div class="card"><h4>Frequency Plan</h4>
            <p th:text="${sensor.frequencyPlan} ?: '--'">--</p></div>
    </section>

    <!-- Live data PAR TYPE (structure fixe rendue côté serveur) -->
    <h3 class="section-title">Live data</h3>

    <!-- COUNT -->
    <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'COUNT')}">
        <div class="card">
            <h4>Battery</h4>
            <p><span id="s-count-batt" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Period IN</h4>
            <p><span id="s-count-in" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Period OUT</h4>
            <p><span id="s-count-out" class="badge">--</span></p>
        </div>
    </section>

    <!-- OCCUP -->
    <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'OCCUP')}">
        <div class="card">
            <h4>Occupancy</h4>
            <p><span id="s-occup-presence" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Illuminance</h4>
            <p><span id="s-occup-illum" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Battery</h4>
            <p><span id="s-occup-batt" class="badge">--</span></p>
        </div>
    </section>

    <!-- TEMPEX -->
    <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'TEMPEX')}">
        <div class="card">
            <h4>Temperature</h4>
            <p><span id="s-tempex-temp" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Humidity</h4>
            <p><span id="s-tempex-hum" class="badge">--</span></p>
        </div>
    </section>

    <!-- PIR_LIGHT -->
    <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'PIR_LIGHT')}">
        <div class="card">
            <h4>PIR</h4>
            <p><span id="s-pir-presence" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Daylight</h4>
            <p><span id="s-pir-daylight" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Battery</h4>
            <p><span id="s-pir-batt" class="badge">--</span></p>
        </div>
    </section>

    <!-- DESK -->
    <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'DESK')}">
        <div class="card">
            <h4>Temperature</h4>
            <p><span id="s-desk-temp" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Humidity</h4>
            <p><span id="s-desk-hum" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>VDD</h4>
            <p><span id="s-desk-vdd" class="badge">--</span></p>
        </div>
    </section>

    <!-- CO2 -->
    <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'CO2')}">
        <div class="card">
            <h4>CO₂</h4>
            <p><span id="s-co2-ppm" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Temperature</h4>
            <p><span id="s-co2-temp" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Humidity</h4>
            <p><span id="s-co2-hum" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>VDD</h4>
            <p><span id="s-co2-vdd" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Light</h4>
            <p><span id="s-co2-light" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Motion</h4>
            <p><span id="s-co2-motion" class="badge">--</span></p>
        </div>
    </section>

    <!-- SON -->
    <section class="info-grid"
             th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'SON')}">
        <div class="card">
            <h4>LAeq</h4>
            <p><span id="s-sound-laeq" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>LAI</h4>
            <p><span id="s-sound-lai" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>LAImax</h4>
            <p><span id="s-sound-laimax" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Battery</h4>
            <p><span id="s-sound-batt" class="badge">--</span></p>
        </div>
    </section>

    <!-- EYE -->
    <section class="info-grid"
             th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'EYE')}">
        <div class="card">
            <h4>Temperature</h4>
            <p><span id="s-eye-temp" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Humidity</h4>
            <p><span id="s-eye-hum" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Light</h4>
            <p><span id="s-eye-light" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Presence</h4>
            <p><span id="s-eye-presence" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>VDD</h4>
            <p><span id="s-eye-vdd" class="badge">--</span></p>
        </div>
    </section>

    <!-- GENERIC (fallback) -->
    <section class="info-grid"
             th:if="${!(#strings.equalsIgnoreCase(sensor.deviceType,'COUNT')
                or #strings.equalsIgnoreCase(sensor.deviceType,'OCCUP')
                or #strings.equalsIgnoreCase(sensor.deviceType,'PIR_LIGHT')
                or #strings.equalsIgnoreCase(sensor.deviceType,'DESK')
                or #strings.equalsIgnoreCase(sensor.deviceType,'CO2')
                or #strings.equalsIgnoreCase(sensor.deviceType,'TEMPEX'))}">
        <div class="card">
            <h4>Battery</h4>
            <p><span id="s-gen-batt" class="badge">--</span></p>
        </div>
    </section>

    <!-- Bloc Réseau / Radio -->
    <h3 class="section-title">Network / Radio</h3>
    <section id="net-grid" class="info-grid">
        <div class="card">
            <h4>Last seen</h4>
            <p><span id="s-last" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>App / Device</h4>
            <p><span id="s-app" class="badge">--</span> / <span id="s-device" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>f_cnt / f_port</h4>
            <p><span id="s-fcnt" class="badge">--</span> / <span id="s-fport" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>Gateway RX</h4>
            <p><span id="s-rxgw" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>RSSI / SNR</h4>
            <p><span id="s-rssi" class="badge">--</span> / <span id="s-snr" class="badge">--</span></p>
        </div>
        <div class="card">
            <h4>SF / BW / Freq</h4>
            <p><span id="s-dr" class="badge">--</span></p>
        </div>
    </section>

</main>

</body>
</html>
