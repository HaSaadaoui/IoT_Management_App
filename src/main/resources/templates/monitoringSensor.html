<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title th:text="'Sensor Monitoring - ' + ${sensor.idSensor}">Sensor Monitoring</title>
    <link rel="stylesheet" href="/css/styles.css"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}"/>
    <link rel="stylesheet" href="/css/monitoringSensor.css"/>


    <script th:inline="javascript">
        document.documentElement.dataset.deviceId  = /*[[${sensor.idSensor}]]*/ '';
        document.documentElement.dataset.gatewayId = /*[[${sensor.idGateway}]]*/ '';
        document.documentElement.dataset.devType   = /*[[${sensor.deviceType}]]*/ '';
        document.documentElement.dataset.sseToken  = /*[[${sseToken}]]*/ '';
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1"></script>

    <script src="/javascript/monitoringSensor.js" defer></script>
</head>

<body data-page="monitoringSensor">
<header class="app-header">
    <a href="javascript:history.back()" class="back-btn" title="Back to list" style="margin-right: 20px">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 30" width="30" height="30" role="img"
             aria-label="Fl√®che arri√®re violette">
            <circle cx="15" cy="15" r="13" fill="none" stroke="#662179" stroke-width="2"/>
            <path d="M17 9 L11 15 L17 21" fill="none" stroke="#662179" stroke-width="2" stroke-linecap="round"
                  stroke-linejoin="round"/>
            <line x1="11" y1="15" x2="22" y2="15" stroke="#662179" stroke-width="2" stroke-linecap="round"/>
        </svg>
    </a>
    <div class="header-title-gateway">
        <span id="sensorDeviceId" th:text="${sensor.idSensor}">--</span>
    </div>
    <div class="header-right">
        <div class="header-user">
            <a th:href="@{/users/{username}(username=${loggedUsername})}" class="header-link">
                <img th:src="${user.icon}"
                     class="header-avatar"
                     alt="User Avatar"
                     width="32" height="32">
            </a>
        </div>
    </div>
</header>

<main>

    <!-- Onglets -->
    <nav class="tabs">
        <button class="tab-btn is-active" data-pane="live">Real-time</button>
        <button class="tab-btn" data-pane="history">History</button>
    </nav>

    <!-- ===== Panneau LIVE ===== -->
    <section id="pane-live">
        <!-- Infos statiques -->
        <h3 class="section-title">üìä Sensor Information</h3>
        <section class="info-grid">
            <div class="card">
                <h4>Status</h4>
                <p id="sensor-status-container">
                  <span id="sensor-status" class="badge" th:classappend="${sensor.status} ? ' badge--ok' : ' badge--off'">
                    <img th:src="${sensor.status} ? '/image/toggle_on.svg' : '/image/toggle_off.svg'" alt="Status"/>
                    <span id="sensor-status-text" th:text="${sensor.status} ? 'Active' : 'Inactive'">--</span>
                  </span>
                </p>
            </div>

            <div class="card"><h4>DevEUI</h4><p th:text="${sensor.devEui} ?: '--'">--</p></div>

            <div class="card">
                <h4>Gateway</h4>
                <p th:with="gid=${sensor.idGateway}, ip=${gatewayIp} ?: ''">
                    <a class="link"
                       th:href="@{|/manage-gateways/monitoring/${gid}/view?ip=${ip}|}" 
                       th:text="${gid}">--</a>
                </p>
            </div>

            <div class="card"><h4>Building</h4><p th:text="${sensor.buildingName} ?: '--'">--</p></div>
            <div class="card"><h4>Floor</h4><p th:text="${sensor.floor} ?: '--'">--</p></div>
            <div class="card"><h4>Type</h4><p th:text="${sensor.deviceType} ?: '--'">--</p></div>
            <div class="card"><h4>Last seen</h4><p><span id="s-last" class="badge">--</span></p></div>
            <div class="card"><h4>Protocol</h4><p><span class="badge">LoRaWAN</span></p></div>
        </section>

        <!-- Last seen PAR TYPE -->
        <h3 class="section-title">üïí Last seen</h3>

        <!-- COUNT -->
        <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'COUNT')}">
            <div class="card"><h4 class="with-icon icon-signal">Battery</h4>
                <p><span id="s-count-batt" class="battery-badge">
                    <svg viewBox="0 0 46 24"><rect x="1" y="5" width="38" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="41" y="9" width="4" height="6" rx="1" fill="currentColor"/></svg>
                    <span>--</span>
                </span></p></div>
            <div class="card"><h4>Period IN (Entries)</h4><p><span id="s-count-in" class="badge">--</span></p></div>
            <div class="card"><h4>Period OUT (Exits)</h4><p><span id="s-count-out" class="badge">--</span></p></div>
        </section>

        <!-- OCCUP -->
        <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'OCCUP')}">
            <div class="card"><h4>Occupancy</h4><p><span id="s-occup-presence" class="badge">--</span></p></div>
            <div class="card"><h4 class="with-icon icon-distance">Distance (mm)</h4><p><span id="s-occup-illum" class="badge">--</span></p></div>
            <div class="card"><h4>Battery</h4>
                <p><span id="s-occup-batt" class="battery-badge">
                    <svg viewBox="0 0 46 24"><rect x="1" y="5" width="38" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="41" y="9" width="4" height="6" rx="1" fill="currentColor"/></svg>
                    <span>--</span>
                </span></p></div>
        </section>

        <!-- TEMPEX -->
        <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'TEMPEX')}">
            <div class="card"><h4 class="with-icon icon-temp">Temperature</h4><p><span id="s-tempex-temp" class="badge">--</span></p></div>
            <div class="card"><h4 class="with-icon icon-hum">Humidity</h4><p><span id="s-tempex-hum" class="humidity-badge humidity--normal">--</span></p></div>
            <div class="card"><h4>Battery</h4>
                <p><span id="s-tempex-batt" class="battery-badge">
                    <svg viewBox="0 0 46 24"><rect x="1" y="5" width="38" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="41" y="9" width="4" height="6" rx="1" fill="currentColor"/></svg>
                    <span>--</span>
                </span></p></div>
        </section>

        <!-- PIR_LIGHT -->
        <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'PIR_LIGHT')}">
            <div class="card"><h4>PIR</h4><p><span id="s-pir-presence" class="badge">--</span></p></div>
            <div class="card"><h4>Daylight</h4><p><span id="s-pir-daylight" class="badge">--</span></p></div>
            <div class="card"><h4>Battery</h4>
                <p><span id="s-pir-batt" class="battery-badge">
                    <svg viewBox="0 0 46 24"><rect x="1" y="5" width="38" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="41" y="9" width="4" height="6" rx="1" fill="currentColor"/></svg>
                    <span>--</span>
                </span></p></div>
        </section>

        <!-- DESK -->
        <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'DESK')}">
            <div class="card"><h4>üë§ Occupancy</h4><p><span id="s-desk-occupancy" class="badge">--</span></p></div>
            <div class="card"><h4 class="with-icon icon-temp">Temperature</h4><p><span id="s-desk-temp" class="temp-badge temp--normal">--</span></p></div>
            <div class="card"><h4 class="with-icon icon-hum">Humidity</h4><p><span id="s-desk-hum" class="humidity-badge humidity--normal">-- %</span></p></div>
            <div class="card"><h4>Battery</h4>
                <p><span id="s-desk-vdd" class="battery-badge">
                    <svg viewBox="0 0 46 24"><rect x="1" y="5" width="38" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="41" y="9" width="4" height="6" rx="1" fill="currentColor"/></svg>
                    <span>--</span>
                </span></p></div>
        </section>

        <!-- CO2 -->
        <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'CO2')}">
            <div class="card">
                <h4>üí® CO‚ÇÇ Level</h4>
                <p><span id="s-co2-ppm" class="co2-badge co2--good">-- ppm</span></p>
            </div>
            <div class="card"><h4 class="with-icon icon-temp">Temperature</h4><p><span id="s-co2-temp" class="temp-badge temp--normal">--</span></p></div>
            <div class="card"><h4 class="with-icon icon-hum">Humidity</h4><p><span id="s-co2-hum" class="humidity-badge humidity--normal">--</span></p></div>
            <div class="card"><h4>Battery</h4>
                <p><span id="s-co2-vdd" class="battery-badge">
                    <svg viewBox="0 0 46 24"><rect x="1" y="5" width="38" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="41" y="9" width="4" height="6" rx="1" fill="currentColor"/></svg>
                    <span>--</span>
                </span></p></div>
            <div class="card"><h4>üí° Light</h4><p><span id="s-co2-light" class="badge">--</span></p></div>
            <div class="card"><h4>üë§ Motion</h4><p><span id="s-co2-motion" class="badge">--</span></p></div>
        </section>

        <!-- SON -->
        <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'SON')}">
            <div class="card"><h4>LAeq</h4><p><span id="s-sound-laeq" class="badge">--</span></p></div>
            <div class="card"><h4>LAI</h4><p><span id="s-sound-lai" class="badge">--</span></p></div>
            <div class="card"><h4>LAImax</h4><p><span id="s-sound-laimax" class="badge">--</span></p></div>
            <div class="card"><h4>Battery</h4>
                <p><span id="s-sound-batt" class="battery-badge">
                    <svg viewBox="0 0 46 24"><rect x="1" y="5" width="38" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="41" y="9" width="4" height="6" rx="1" fill="currentColor"/></svg>
                    <span>--</span>
                </span></p></div>
        </section>

        <!-- EYE -->
        <section class="info-grid" th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'EYE')}">
            <div class="card"><h4 class="with-icon icon-temp">Temperature</h4><p><span id="s-eye-temp" class="badge">--</span></p></div>
            <div class="card"><h4 class="with-icon icon-hum">Humidity</h4><p><span id="s-eye-hum" class="humidity-badge humidity--normal">--</span></p></div>
            <div class="card"><h4>Light</h4><p><span id="s-eye-light" class="badge">--</span></p></div>
            <div class="card"><h4>Presence</h4><p><span id="s-eye-presence" class="badge">--</span></p></div>
            <div class="card"><h4>Battery</h4>
                <p><span id="s-eye-vdd" class="battery-badge">
                    <svg viewBox="0 0 46 24"><rect x="1" y="5" width="38" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="41" y="9" width="4" height="6" rx="1" fill="currentColor"/></svg>
                    <span>--</span>
                </span></p></div>
        </section>

        <!-- GENERIC -->
        <section class="info-grid" th:if="${!(#strings.equalsIgnoreCase(sensor.deviceType,'COUNT')
          or #strings.equalsIgnoreCase(sensor.deviceType,'OCCUP')
          or #strings.equalsIgnoreCase(sensor.deviceType,'PIR_LIGHT')
          or #strings.equalsIgnoreCase(sensor.deviceType,'DESK')
          or #strings.equalsIgnoreCase(sensor.deviceType,'CO2')
          or #strings.equalsIgnoreCase(sensor.deviceType,'TEMPEX')
          or #strings.equalsIgnoreCase(sensor.deviceType,'SON')
          or #strings.equalsIgnoreCase(sensor.deviceType,'EYE')
          or #strings.equalsIgnoreCase(sensor.deviceType,'ENERGY')
          or #strings.equalsIgnoreCase(sensor.deviceType,'CONSO'))}">
            <div class="card"><h4>Battery</h4>
                <p><span id="s-gen-batt" class="battery-badge">
                    <svg viewBox="0 0 46 24"><rect x="1" y="5" width="38" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><rect x="41" y="9" width="4" height="6" rx="1" fill="currentColor"/></svg>
                    <span>--</span>
                </span></p></div>
        </section>

        <!-- ENERGY/CONSO - Energy Consumption -->
        <section th:if="${#strings.equalsIgnoreCase(sensor.deviceType,'ENERGY') or #strings.equalsIgnoreCase(sensor.deviceType,'CONSO')}">
            <h3 class="section-title">‚ö° Energy Consumption</h3>
            
            <!-- Dashboard principal -->
            <div class="energy-dashboard">
                <!-- Groupes de consommation -->
                <div class="energy-groups">
                    <div id="energy-group-red-outlets" class="energy-group">
                        <div class="energy-group-header">
                            <span class="group-name">üî¥ Red Outlets</span>
                            <span class="group-channels">Channels 0, 1, 2</span>
                        </div>
                        <div class="energy-group-values">
                            <div class="wh-value">-- Wh</div>
                            <div class="kwh-value">-- kWh</div>
                        </div>
                    </div>
                    
                    <div id="energy-group-white-outlets" class="energy-group">
                        <div class="energy-group-header">
                            <span class="group-name">‚ö™ White Outlets & Lighting</span>
                            <span class="group-channels">Channels 3, 4, 5</span>
                        </div>
                        <div class="energy-group-values">
                            <div class="wh-value">-- Wh</div>
                            <div class="kwh-value">-- kWh</div>
                        </div>
                    </div>
                    
                    <div id="energy-group-ventilation" class="energy-group">
                        <div class="energy-group-header">
                            <span class="group-name">üå¨Ô∏è Ventilation & Heaters</span>
                            <span class="group-channels">Channels 6, 7, 8</span>
                        </div>
                        <div class="energy-group-values">
                            <div class="wh-value">-- Wh</div>
                            <div class="kwh-value">-- kWh</div>
                        </div>
                    </div>
                    
                    <div id="energy-group-other" class="energy-group">
                        <div class="energy-group-header">
                            <span class="group-name">üîß Other Circuits</span>
                            <span class="group-channels">Channels 9, 10, 11</span>
                        </div>
                        <div class="energy-group-values">
                            <div class="wh-value">-- Wh</div>
                            <div class="kwh-value">-- kWh</div>
                        </div>
                    </div>
                </div>
                
                <!-- Total et graphique -->
                <div>
                    <div id="energy-total" class="energy-total">
                        <div class="total-consumption">
                            <div class="total-label">Total Consumption</div>
                            <div class="total-values">
                                <div class="total-kwh">-- kWh</div>
                            </div>
                        </div>
                    </div>
                    
                    <div id="energy-chart" class="energy-chart" style="margin-top: 1.5rem;">
                        <div style="text-align: center; color: #64748b; padding: 2rem;">
                            üìä Real-time Chart<br>
                            <small>Data will appear automatically</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Channel Details -->
            <h4 class="section-title" style="font-size: 1.1rem; margin-top: 2rem;">Channel Details</h4>
            <div class="energy-channels">
                <div id="energy-channel-0" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 0</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-1" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 1</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-2" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 2</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-3" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 3</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-4" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 4</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-5" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 5</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-6" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 6</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-7" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 7</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-8" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 8</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-9" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 9</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-10" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 10</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
                <div id="energy-channel-11" class="energy-channel">
                    <div class="energy-channel-header">
                        <span class="channel-number">Channel 11</span>
                        <span class="channel-uuid">--</span>
                    </div>
                    <div class="energy-value">
                        <span class="value">--</span>
                        <span class="unit">Wh</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Graphiques en temps r√©el -->
        <h3 class="section-title">üìà Real-Time Data</h3>
        <section class="realtime-charts">
            <div class="chart-grid">
                <!-- Graphique principal selon le type de capteur -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h4 id="realtime-chart-title">Primary Data</h4>
                        <div class="chart-controls">
                            <button id="chart-pause" class="chart-btn">‚è∏Ô∏è Pause</button>
                            <button id="chart-clear" class="chart-btn">üóëÔ∏è Clear</button>
                        </div>
                    </div>
                    <div class="chart-canvas-wrapper">
                        <canvas id="realtime-chart-main"></canvas>
                    </div>
                </div>
                
                <!-- Graphique secondaire -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h4 id="realtime-chart-secondary-title">Secondary Data</h4>
                        <div class="chart-legend" id="secondary-legend"></div>
                    </div>
                    <div class="chart-canvas-wrapper">
                        <canvas id="realtime-chart-secondary"></canvas>
                    </div>
                </div>
                
                <!-- Humidity Chart for CO2 and DESK sensors -->
                <div class="chart-container" id="humidity-chart-container" style="display: none;">
                    <div class="chart-header">
                        <h4>üíß Humidity</h4>
                    </div>
                    <div class="chart-canvas-wrapper">
                        <canvas id="realtime-chart-humidity"></canvas>
                    </div>
                </div>
                
            </div>
        </section>

        <!-- Network / Radio -->
        <h3 class="section-title">üì° Network / Radio</h3>
        
        <section id="net-grid" class="info-grid">
            <div class="card"><h4>Frequency Plan</h4><p th:text="${
                sensor.frequencyPlan == 'EU_863_870_TTN' ? 'Europe' :
                sensor.frequencyPlan == 'US_902_928_FSB_2' ? 'United States' :
                sensor.frequencyPlan == 'AU_915_928_FSB_2' ? 'Australia' :
                sensor.frequencyPlan == 'CN_470_510_FSB_11' ? 'China' :
                sensor.frequencyPlan == 'AS_920_923' ? 'Asia' : (sensor.frequencyPlan ?: '--')
            }">--</p></div>
            <div class="card"><h4>Frame Counter / Port</h4><p class="labeled-values">
                <span class="value-line">f_cnt: <span id="s-fcnt" class="badge">--</span></span>
                <span class="value-line">f_port: <span id="s-fport" class="badge">--</span></span>
            </p></div>
            <div class="card"><h4 class="with-icon icon-signal">Signal Quality</h4><p class="labeled-values">
                <span class="value-line">RSSI: <span id="s-rssi" class="badge">--</span></span>
                <span class="value-line">SNR: <span id="s-snr" class="badge">--</span></span>
            </p></div>
            <div class="card"><h4>Radio Parameters</h4><p class="labeled-values">
                <span class="value-line">SF: <span id="s-sf" class="badge">--</span></span>
                <!--<span class="value-line">BW: <span id="s-bw" class="badge">--</span></span>-->
                <!--<span class="value-line">CR: <span id="s-cr" class="badge">--</span></span>-->
                <span class="value-line">Freq: <span id="s-freq" class="badge">--</span></span>
            </p></div>
        </section>
        
        <!-- Signal Quality Charts -->
        <section class="realtime-charts">
            <div class="chart-grid">
                <!-- RSSI Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h4>üì∂ RSSI Signal Strength</h4>
                        <div class="chart-legend">
                            <span class="legend-item"><span class="legend-color" style="background: #ef4444;"></span> RSSI</span>
                        </div>
                    </div>
                    <div class="chart-canvas-wrapper">
                        <canvas id="realtime-chart-rssi"></canvas>
                    </div>
                </div>
                
                <!-- SNR Chart -->
                <div class="chart-container">
                    <div class="chart-header">
                        <h4>üì° SNR Signal Quality</h4>
                        <div class="chart-legend">
                            <span class="legend-item"><span class="legend-color" style="background: #3b82f6;"></span> SNR</span>
                        </div>
                    </div>
                    <div class="chart-canvas-wrapper">
                        <canvas id="realtime-chart-snr"></canvas>
                    </div>
                </div>
            </div>
        </section>
    </section>

    <!-- ===== Panneau HISTORIQUE ===== -->
    <section id="pane-history" class="hidden">
        <h3 class="section-title">üìä History & Analysis</h3>

        <!-- Filtres de p√©riode -->
        <div class="history-filters card">
            <div class="filter-grid">
                <div class="filter-item">
                    <label for="hist-from">üìÖ Start Date</label>
                    <input type="datetime-local" id="hist-from">
                </div>
                <div class="filter-item">
                    <label for="hist-to">üìÖ End Date</label>
                    <input type="datetime-local" id="hist-to">
                </div>
                <div class="filter-item" style="align-self:end;">
                    <button id="hist-load" class="btn btn-primary">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 0.5rem;">
                            <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm3.5 7.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5z"/>
                        </svg>
                        Load Data
                    </button>
                </div>
            </div>
        </div>

        <!-- KPI Cards - Statistiques cl√©s -->
        <div class="kpi-grid">
            <div class="kpi-card kpi-card--primary">
                <div class="kpi-icon">üìä</div>
                <div class="kpi-content">
                    <div class="kpi-label">Total Measurements</div>
                    <div class="kpi-value" id="kpi-total">--</div>
                </div>
            </div>
            <div class="kpi-card kpi-card--success">
                <div class="kpi-icon">üîã</div>
                <div class="kpi-content">
                    <div class="kpi-label">Average Battery</div>
                    <div class="kpi-value" id="kpi-battery">--</div>
                </div>
            </div>
            <div class="kpi-card kpi-card--info">
                <div class="kpi-icon">üì°</div>
                <div class="kpi-content">
                    <div class="kpi-label">Average Signal (RSSI)</div>
                    <div class="kpi-value" id="kpi-rssi">--</div>
                </div>
            </div>
            <div class="kpi-card kpi-card--warning">
                <div class="kpi-icon">‚è±Ô∏è</div>
                <div class="kpi-content">
                    <div class="kpi-label">Analyzed Period</div>
                    <div class="kpi-value" id="kpi-period">--</div>
                </div>
            </div>
        </div>

        <!-- Graphiques principaux -->
        <div class="charts-section">
            <h4 class="subsection-title">üìà Time Evolution</h4>
            <div class="charts-grid">

                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">
                            <span class="chart-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">üì°</span>
                            <span>Signal Quality (RSSI)</span>
                        </div>
                        <div class="chart-info">dBm</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="histRssi"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">
                            <span class="chart-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">üì∂</span>
                            <span>Signal-to-Noise Ratio (SNR)</span>
                        </div>
                        <div class="chart-info">dB</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="histSnr"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- M√©triques sp√©cifiques au capteur -->
            <section class="realtime-charts" id="sensor-metrics-section">
                <div class="chart-grid" id="history-metrics-container">
            </section>
        </div>

    </section>

</main>
</body>
</html>
